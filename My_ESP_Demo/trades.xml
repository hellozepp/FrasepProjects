<project name="trades" pubsub="auto" threads="4" heartbeat-interval="1">
  <metadata>
    <meta id="layout">{"trades_cq":{"AddEspTimestamp":{"x":370,"y":-35},"BySecurity":{"x":410,"y":475},"LargeTrades":{"x":370,"y":105},"Scoring":{"x":125,"y":475},"TotalCost":{"x":370,"y":295},"Trades":{"x":370,"y":-205}}}</meta>
    <meta id="studioModifiedBy">viyademo01</meta>
    <meta id="studioModified">1633613281785</meta>
    <meta id="studioUploadedBy">viyademo01</meta>
    <meta id="studioUploaded">1633586273512</meta>
    <meta id="mm_linked_module1">e0500b6a-a1a0-40d5-8a83-43689251bcad,0c6762fd-fe47-4b0c-b10f-e7c0e1a07980,ds2MultiType,Trade_ML001,outliers_svdd,2</meta>
    <meta id="mm_astore_module1_0">_687B4A0F93E8C9D1E867F6DFF_AST,file:///models/astores/viya/_687B4A0F93E8C9D1E867F6DFF_AST.astore</meta>
    <meta id="mm_linked_module2">a26ff577-2a3f-48a0-bf44-359ad3390baa,b6090455-c876-4689-bf74-cb84b7cb89f9,ds2MultiType,Trade_ML001,outliers_isolation_forest,2</meta>
    <meta id="mm_astore_module2_0">_9D3305BF53FE05A165B044D4A_AST,file:///models/astores/viya/_9D3305BF53FE05A165B044D4A_AST.astore</meta>
  </metadata>
  <mas-modules>
    <mas-module module="module1" language="ds2" func-names="init,score" mas-store="e0500b6a-a1a0-40d5-8a83-43689251bcad_champion_ab2ac039-82c2-486f-b91a-bc4ab8281433" mas-store-version="0.1">
      <description><![CDATA[Project: Trade_ML001; model: outliers_svdd; version: 2]]></description>
      <code-file><![CDATA[dmcas_packagescorecode.sas]]></code-file>
      <module-members>
        <module-member member="astore_0" type="astore" SHAkey="687B4A0F93E8C9D1E867F6DFF925CBA99EDEA5B9">
          <code-file><![CDATA[_687B4A0F93E8C9D1E867F6DFF_AST]]></code-file>
        </module-member>
      </module-members>
    </mas-module>
    <mas-module module="module2" language="ds2" func-names="init,score" mas-store="a26ff577-2a3f-48a0-bf44-359ad3390baa_champion_ab2ac039-82c2-486f-b91a-bc4ab8281433" mas-store-version="0.1">
      <description><![CDATA[Project: Trade_ML001; model: outliers_isolation_forest; version: 2]]></description>
      <code-file><![CDATA[dmcas_packagescorecode.sas]]></code-file>
      <module-members>
        <module-member member="astore_0" type="astore" SHAkey="9D3305BF53FE05A165B044D4A3BE2B1E9FA49CC6">
          <code-file><![CDATA[_9D3305BF53FE05A165B044D4A_AST]]></code-file>
        </module-member>
      </module-members>
    </mas-module>
  </mas-modules>
  <contqueries>
    <contquery name="trades_cq">
      <windows>
        <window-source pubsub="true" collapse-updates="false" name="Trades">
          <schema>
            <fields>
              <field name="tradeID" type="string" key="true"/>
              <field name="security" type="string"/>
              <field name="quantity" type="int32"/>
              <field name="price" type="double"/>
              <field name="totalCost" type="double"/>
              <field name="traderID" type="int64"/>
              <field name="time" type="stamp"/>
              <field name="name" type="string"/>
            </fields>
          </schema>
          <connectors>
            <connector class="fs" name="trade_sample">
              <properties>
                <property name="type"><![CDATA[pub]]></property>
                <property name="rate"><![CDATA[50]]></property>
                <property name="fsname"><![CDATA[/home/viyademo01/my_git/My_ESP_Demo/data/trade_events_sample.csv]]></property>
                <property name="fstype"><![CDATA[csv]]></property>
              </properties>
            </connector>
          </connectors>
        </window-source>
        <window-filter pubsub="true" name="LargeTrades">
          <expression><![CDATA[quantity >= 100]]></expression>
        </window-filter>
        <window-compute pubsub="true" name="TotalCost">
          <description><![CDATA[This is a compute window. The non-key fields are computed
        in the output section.]]></description>
          <schema>
            <fields>
              <field name="tradeID" type="string" key="true"/>
              <field name="security" type="string"/>
              <field name="quantity" type="int32"/>
              <field name="price" type="double"/>
              <field name="totalCost" type="double"/>
              <field name="traderID" type="int64"/>
              <field name="time" type="stamp"/>
              <field name="name" type="string"/>
            </fields>
          </schema>
          <output>
            <field-expr><![CDATA[security]]></field-expr>
            <field-expr><![CDATA[quantity]]></field-expr>
            <field-expr><![CDATA[price]]></field-expr>
            <field-expr><![CDATA[price*quantity]]></field-expr>
            <field-expr><![CDATA[traderID]]></field-expr>
            <field-expr><![CDATA[time]]></field-expr>
            <field-expr><![CDATA[name]]></field-expr>
          </output>
          <connectors>
            <connector class="fs" name="trade_csv_file">
              <properties>
                <property name="type"><![CDATA[sub]]></property>
                <property name="snapshot"><![CDATA[false]]></property>
                <property name="fsname"><![CDATA[/tmp/trade_events.csv]]></property>
                <property name="fstype"><![CDATA[csv]]></property>
              </properties>
            </connector>
          </connectors>
        </window-compute>
        <window-aggregate pubsub="true" name="BySecurity">
          <schema>
            <fields>
              <field name="security" type="string" key="true"/>
              <field name="quantityTotal" type="double"/>
              <field name="costTotal" type="double"/>
            </fields>
          </schema>
          <output>
            <field-expr><![CDATA[ESP_aSum(quantity)]]></field-expr>
            <field-expr><![CDATA[ESP_aSum(totalCost)]]></field-expr>
          </output>
        </window-aggregate>
        <window-functional pubsub="true" name="AddEspTimestamp">
          <schema>
            <fields>
              <field name="tradeID" type="string" key="true"/>
              <field name="security" type="string"/>
              <field name="quantity" type="int32"/>
              <field name="price" type="double"/>
              <field name="traderID" type="int64"/>
              <field name="time" type="stamp"/>
              <field name="name" type="string"/>
            </fields>
          </schema>
          <function-context>
            <functions>
              <function name="time"><![CDATA[eventTimestamp()]]></function>
            </functions>
          </function-context>
        </window-functional>
        <window-calculate pubsub="true" name="Scoring" algorithm="MAS">
          <schema>
            <fields>
              <field name="tradeID" type="string" key="true"/>
              <field name="security" type="string"/>
              <field name="quantity" type="int32"/>
              <field name="price" type="double"/>
              <field name="totalCost" type="double"/>
              <field name="traderID" type="int64"/>
              <field name="time" type="stamp"/>
              <field name="name" type="string"/>
              <field name="_Anomaly_" type="double"/>
            </fields>
          </schema>
          <mas-map>
            <window-map module="module2" function="score" revision="0" source="TotalCost"/>
          </mas-map>
        </window-calculate>
      </windows>
      <edges>
        <edge source="AddEspTimestamp" target="LargeTrades"/>
        <edge source="TotalCost" target="BySecurity"/>
        <edge source="Trades" target="AddEspTimestamp"/>
        <edge source="TotalCost" target="Scoring" role="data"/>
        <edge source="LargeTrades" target="TotalCost"/>
      </edges>
    </contquery>
  </contqueries>
</project>